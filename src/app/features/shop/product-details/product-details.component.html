<p-toast />
<app-header />
<section class="bg-light">
  <div class="container pb-5" style="margin-top: 40px !important">
    <div class="row">
      <div class="col-lg-7 mt-5">
        <app-image-slider [images]="variationList"></app-image-slider>
      </div>
      <!-- col end -->
      <div class="col-lg-5 mt-5">
        <div class="card">
          <div class="card-body">
            <div>
              <h1 class="h2">{{ product?.name }}</h1>
              <button
                type="button"
                class="btn btn-primary btn-sm mb-2"
                data-bs-toggle="modal"
                data-bs-target="#exampleModalFullscreen"
                fdprocessedid="8he3e"
              >
                Th·ª≠ √°o online (th·ª≠ nghi·ªám)
              </button>

              <div
                class="modal fade"
                id="exampleModalFullscreen"
                tabindex="-1"
                aria-labelledby="exampleModalFullscreenLabel"
                style="display: none"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-fullscreen">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1
                        class="modal-title fs-4"
                        id="exampleModalFullscreenLabel"
                      >
                        Th·ª≠ √°o online (th·ª≠ nghi·ªám)
                      </h1>
                    </div>
                    <div
                      class="modal-body d-flex flex-wrap justify-content-evenly"
                    >
                      <!-- Ph·∫ßn 1: Ch·ªçn v√† hi·ªÉn th·ªã ·∫£nh ng∆∞·ªùi d√πng t·∫£i l√™n -->
                      <div
                        class="col-12 col-md-4 d-flex align-items-center justify-content-center col-avatar border-section"
                      >
                        <div class="d-flex align-items-center flex-column">
                          <!-- N√∫t ch·ªçn ·∫£nh -->
                          <label
                            for="choose-pic"
                            class="border p-1 mt-3 mb-2 rounded-2"
                            style="cursor: pointer"
                            >Ch·ªçn ·∫£nh selfie c·ªßa b·∫°n</label
                          >
                          <input
                            type="file"
                            name="choose-pic"
                            id="choose-pic"
                            hidden
                            (change)="onFileSelected($event)"
                          />

                          <p class="format-pic-title">
                            ·∫¢nh c√†ng ƒë∆°n gi·∫£n - "th·ª≠ √°o" c√†ng nhanh
                          </p>
                          <img
                            *ngIf="uploadedImage"
                            [src]="uploadedImage"
                            alt="Uploaded Image"
                            style="max-width: 200px; margin-top: 10px"
                          />

                          <button
                            type="button"
                            class="btn btn-primary btn-sm mt-3"
                            (click)="uploadImageToCloud()"
                            [hidden]="
                              !uploadedImage ||
                              (!isLoading && responseImageFromCloudinary) ||
                              isLoading
                            "
                          >
                            T·∫£i l√™n
                          </button>
                          <p *ngIf="isLoading">ƒêang t·∫£i l√™n...</p>
                          <p *ngIf="!isLoading && responseImageFromCloudinary">
                            ƒê√£ t·∫£i l√™n ‚úî
                          </p>
                        </div>
                      </div>

                      <!-- Ph·∫ßn gi·ªØa: Ch·ªçn ·∫£nh trong this.variationList v√† hi·ªÉn th·ªã ·∫£nh ng∆∞·ªùi d√πng ch·ªçn -->
                      <div
                        class="col-12 col-md-3 d-flex flex-column align-items-center justify-content-center border-section"
                      >
                        <h2>Ch·ªçn √°o c·∫ßn th·ª≠</h2>
                        <div class="image-selection d-flex flex-wrap">
                          <div
                            *ngFor="let variation of variationList"
                            class="image-option m-2"
                            (click)="onImageSelect(variation.value)"
                          >
                            <img
                              [src]="variation.value"
                              alt="Product Variation"
                              style="max-width: 60px; cursor: pointer"
                            />
                          </div>
                        </div>
                        <div *ngIf="selectedImage" class="selected-image mt-3">
                          <img
                            [src]="selectedImage"
                            alt="Selected Image"
                            style="max-width: 200px"
                          />
                        </div>
                      </div>

                      <!-- Ph·∫ßn cu·ªëi: ƒê·ªÉ tr·ªëng cho code sau -->
                      <div
                        class="col-12 col-md-4 d-flex flex-column border-section align-items-center justify-content-center"
                      >
                        <p *ngIf="isLoadingStart && !isLoadingRender">
                          ƒêang kh·ªüi t·∫°o... <span>{{ timerValue }} gi√¢y</span>
                        </p>
                        <p *ngIf="isLoadingStart && isLoadingRender">
                          Kh·ªüi t·∫°o th√†nh c√¥ng ‚úî
                        </p>
                        <p *ngIf="isLoadingStart && isLoadingRender">
                          ƒêang ti·∫øn h√†nh thay √°o...
                          <span>{{ timerValue }} gi√¢y</span>
                        </p>
                        <p *ngIf="isLoadingError">
                          ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau! üò¢
                        </p>
                        <button
                          type="button"
                          class="btn btn-primary btn-sm mb-2"
                          (click)="handleTryOnClothes()"
                          [hidden]="
                            (isLoadingStart && isLoadingRender) || outputImage
                          "
                          [disabled]="
                            isLoadingStart ||
                            !uploadedImage ||
                            !selectedImage ||
                            !responseImageFromCloudinary
                          "
                        >
                          M·∫∑c √°o (~ 45 gi√¢y)
                        </button>
                        <div>
                          <img
                            src="{{ outputImage }}"
                            alt=""
                            style="max-width: 200px"
                          />
                        </div>
                        <button
                          type="button"
                          class="btn btn-primary btn-sm mt-2"
                          (click)="downloadImage()"
                          [disabled]="outputImage === null"
                        >
                          T·∫£i ·∫£nh xu·ªëng
                        </button>
                      </div>

                      <div class="col-12 col-md-12 d-flex flex-column">
                        <strong>H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG:</strong>
                        <strong>B∆∞·ªõc 1:</strong>
                        <p>
                          B·∫°n h√£y ch·ªçn ·∫£nh selfie c·ªßa m√¨nh b·∫±ng c√°ch nh·∫•n v√†o
                          n√∫t "Ch·ªçn ·∫£nh selfie c·ªßa b·∫°n" v√† ch·ªçn ·∫£nh t·ª´ m√°y t√≠nh
                          c·ªßa b·∫°n. Sau ƒë√≥ nh·∫•n n√∫t "T·∫£i l√™n". Trang web hi·ªÉn th·ªã
                          "ƒê√£ t·∫£i l√™n ‚úî" l√† ƒë√£ t·∫£i ·∫£nh th√†nh c√¥ng.
                        </p>
                        <strong
                          >L∆∞u √Ω: ·∫£nh c√†ng ƒë∆°n gi·∫£n, c√†ng r√µ r√†ng, dung l∆∞·ª£ng
                          ·∫£nh c√†ng nh·∫π th√¨ t·ªëc ƒë·ªô "M·∫∑c √°o" c√†ng nhanh!</strong
                        >
                        <img
                          src="../../../../assets/images/hdsdtryon.png"
                          alt=""
                        />
                        <strong>B∆∞·ªõc 2:</strong>
                        <p>
                          H√£y ch·ªçn 1 trong nh·ªØng chi·∫øc √°o m√† b·∫°n mu·ªën m·∫∑c th·ª≠.
                        </p>
                        <strong>B∆∞·ªõc 3:</strong>
                        <p>
                          Nh·∫•n n√∫t "M·∫∑c √°o (~ 45 gi√¢y)" ƒë·ªÉ xem k·∫øt qu·∫£. Trong
                          kho·∫£ng th·ªùi gian t·ª´ 30-45 gi√¢y, trang web s·∫Ω hi·ªÉn th·ªã
                          ·∫£nh c·ªßa b·∫°n m·∫∑c chi·∫øc √°o b·∫°n ƒë√£ ch·ªçn.
                        </p>
                        <strong>B∆∞·ªõc 4:</strong>
                        <p>
                          Nh·∫•n n√∫t <strong>"T·∫£i ·∫£nh xu·ªëng"</strong> ƒë·ªÉ l∆∞u ·∫£nh
                          v·ªÅ m√°y t√≠nh c·ªßa b·∫°n. B·ªüi v√¨ ch·ª©c nƒÉng "Th·ª≠ √°o online"
                          ƒëang trong giai ƒëo·∫°n th·ª≠ nghi·ªám n√™n
                          <strong>ch∆∞a h·ªó tr·ª£ </strong>l∆∞u tr·ªØ ·∫£nh ƒë√£ t·∫°o c·ªßa
                          kh√°ch h√†ng.
                        </p>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button
                        id="exitButton"
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                        (click)="resetData()"
                        [hidden]="
                          (uploadedImage && selectedImage) ||
                          uploadedImage ||
                          selectedImage
                        "
                      >
                        Tho√°t
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary"
                        (click)="checkStatusExit()"
                        [hidden]="!uploadedImage && !selectedImage"
                      >
                        ƒê√≥ng
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <p>Th∆∞∆°ng hi·ªáu: {{ product?.brand?.name }}</p>
            <p>Xu·∫•t x·ª©: {{ product?.nation?.name }}</p>
            <span class="d-flex" *ngIf="getVariationBySize(selectedSizeId)">
              Gi√° b√°n:
              <p
                class="ms-2 me-2"
                style="color: rgb(226, 45, 0); font-weight: 700; margin: 0"
              >
                {{
                  (getVariationBySize(selectedSizeId)?.price || 0) -
                    ((getVariationBySize(selectedSizeId)?.price || 0) *
                      (getVariationBySize(selectedSizeId)?.discount || 0)) /
                      100 | currency : "VND" : "symbol"
                }}
              </p>
              <p
                class="ms-2 me-2"
                style="text-decoration: line-through; margin: 0"
                *ngIf="getVariationBySize(selectedSizeId)?.discount !== 0"
              >
                {{ getVariationBySize(selectedSizeId)?.price }}
                <span class="badge bg-danger">
                  -{{ getVariationBySize(selectedSizeId)?.discount || 0 }}%
                </span>
              </p>
            </span>

            <span class="d-flex" *ngIf="!getVariationBySize(selectedSizeId)">
              Gi√° b√°n:
              <p
                class="ms-2 me-2"
                style="color: rgb(226, 45, 0); font-weight: 700; margin: 0"
              >
                {{
                  (product?.productVariations?.[0]?.price || 0) -
                    ((product?.productVariations?.[0]?.price || 0) *
                      (product?.productVariations?.[0]?.discount || 0)) /
                      100 | currency : "VND" : "symbol"
                }}
              </p>
              <p
                class="ms-2 me-2"
                style="text-decoration: line-through; margin: 0"
                *ngIf="product?.productVariations?.[0]?.discount !== 0"
              >
                {{ product?.productVariations?.[0]?.price }}
                <span class="badge bg-danger">
                  -{{ product?.productVariations?.[0]?.discount || 0 }}%
                </span>
              </p>
            </span>
            <div class="d-flex mt-3" *ngIf="getVariationBySizeAndColor()">
              <p class="me-2">C√≤n l·∫°i:</p>
              <p
                style="color: green; font-weight: 700"
                *ngIf="getVariationBySizeAndColor()?.quantity !== 0"
              >
                {{ getVariationBySizeAndColor()?.quantity }}
              </p>
              <p
                style="color: brown; font-style: italic"
                *ngIf="getVariationBySizeAndColor()?.quantity === 0"
              >
                H·∫øt h√†ng. H√£y th·ª≠ ch·ªçn size kh√°c ho·∫∑c m√†u kh√°c!
              </p>
            </div>
            <div class="d-flex mt-3" *ngIf="!getVariationBySizeAndColor()">
              <p class="me-2">C√≤n l·∫°i:</p>
              <p
                style="color: green; font-weight: 700"
                *ngIf="product?.productVariations?.[0]?.quantity !== 0"
              >
                {{product?.productVariations?.[0]?.quantity}}
              </p>
              <p
                style="color: brown; font-style: italic"
                *ngIf="getVariationBySizeAndColor()?.quantity === 0"
              >
                H√£y ch·ªçn size kh√°c ho·∫∑c m√†u s·∫Øc!
              </p>
            </div>
            <div class="d-flex flex-column">
              <p class="me-2">K√≠ch th∆∞·ªõc:</p>
              <div class="ms-3" style="display: flex; flex-wrap: wrap">
                <div
                  class="form-check form-check-inline"
                  *ngFor="let size of getDistinctSizeNames(product)"
                >
                  <input
                    class="form-check-input"
                    type="radio"
                    name="sizeRadioOptions"
                    id="inlineRadio{{ size.id }}"
                    value="{{ size.id }}"
                    [checked]="selectedSizeId === size.id"
                    (click)="onSizeChange($event)"
                    (change)="onSizeChange($event)"
                  />
                  <label
                    class="form-check-label"
                    for="inlineRadio{{ size.id }}"
                    >{{ size.value }}</label
                  >
                </div>
              </div>
            </div>
            <div class="d-flex flex-column mt-3 mb-2" style="width: 100%">
              <p class="mb-0 me-3">M√†u s·∫Øc:</p>
              <div class="ms-3 d-flex" style="flex-wrap: wrap">
                <div
                  class="form-check form-check-inline"
                  *ngFor="let color of colorOptions"
                >
                  <input
                    class="form-check-input"
                    type="radio"
                    name="colorRadioOptions"
                    id="colorRadio{{ color.id }}"
                    value="{{ color.id }}"
                    [disabled]="color.disabled"
                    (change)="onColorChange($event)"
                  />
                  <label
                    class="form-check-label"
                    for="colorRadio{{ color.id }}"
                    >{{ color.value }}</label
                  >
                </div>
              </div>
            </div>

            <!-- test -->
            <div
              class="modal fade"
              id="exampleModalScrollable"
              tabindex="-1"
              aria-labelledby="exampleModalScrollableTitle"
              style="display: none"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalScrollableTitle">
                      H∆∞·ªõng d·∫´n ch·ªçn size
                    </h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <p>
                      ƒê·ªÉ l·∫•y s·ªë ƒëo c·ªßa c∆° th·ªÉ ch√≠nh x√°c, b·∫°n c√≥ th·ªÉ d√πng th∆∞·ªõc
                      d√¢y ƒë·ªÉ ƒëo c√°c th√¥ng s·ªë sau ƒë√¢y:
                    </p>
                    <p>
                      1. V√πng ng·ª±c: D√πng th∆∞·ªõc d√¢y b·ªçc xung quanh ng·ª±c c·ªßa b·∫°n.
                    </p>
                    <p>
                      2. V√≤ng b·ª•ng: D√πng th∆∞·ªõc d√¢y b·ªçc xung quanh b·ª•ng v√† l·∫•y
                      chu vi nh·ªè nh·∫•t c·ªßa b·ª•ng.
                    </p>
                    <p>
                      3. V√≤ng m√¥ng: Kh√©p hai ch√¢n l·∫°i, l·∫•y th∆∞·ªõc d√¢y b·ªçc xung
                      quanh v√πng m√¥ng v√† l·∫•y s·ªë ƒëo chu vi l·ªõn nh·∫•t c·ªßa m√¥ng.
                    </p>
                    <p>
                      4. Chi·ªÅu cao h√°ng: L√† chi·ªÅu d√†i t·ª´ ƒë√°y qu·∫ßn ƒë·∫øn g√≥t ch√¢n.
                    </p>
                    <p>
                      5. Chi·ªÅu cao c∆° th·ªÉ: L√† chi·ªÅu d√†i t√≠nh t·ª´ ph·∫ßn ƒë·∫ßu ƒë·∫øn g√≥t
                      ch√¢n.
                    </p>
                    <h5>B·∫£ng size √°o</h5>
                    <img
                      src="../../../../assets/images/size_tutorial/size_ao.webp"
                      alt=""
                      width="500"
                      class="mt-2 mb-2"
                    />
                    <h5>B·∫£ng size qu·∫ßn</h5>
                    <img
                      src="../../../../assets/images/size_tutorial/size_quan.webp"
                      alt=""
                      width="500"
                      class="mt-2 mb-2"
                    />
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-dark"
                      style="background-color: black"
                      data-bs-dismiss="modal"
                    >
                      ƒê√≥ng
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <button
              type="button"
              class="btn btn-primary mt-3"
              data-bs-toggle="modal"
              data-bs-target="#exampleModalScrollable"
              fdprocessedid="ppfwcs"
            >
              H∆∞·ªõng d·∫´n ch·ªçn size
            </button>
            <!-- test -->
            <div class="d-flex align-items-center pb-2 mb-2 mt-3">
              <!-- <button
                type="button"
                style="background-color: black"
                data-mdb-button-init
                data-mdb-ripple-init
                class="btn btn-dark btn-add-to-cart"
                (click)="handleCartBtnClicked(product)"
              >
                Th√™m v√†o gi·ªè h√†ng
              </button> -->
              <button
                *ngIf="
                  !getVariationBySizeAndColor() ||
                  getVariationBySizeAndColor()?.quantity === 0
                "
                type="button"
                style="background-color: black"
                data-mdb-button-init
                data-mdb-ripple-init
                class="btn btn-dark btn-add-to-cart"
                (click)="
                  handleCartBtnClicked_v2(
                    product,
                    selectedSizeId,
                    selectedColorId
                  )
                "
                disabled
              >
                Th√™m v√†o gi·ªè h√†ng
              </button>
              <button
                *ngIf="
                  getVariationBySizeAndColor() &&
                  getVariationBySizeAndColor()?.quantity !== 0
                "
                type="button"
                style="background-color: black"
                data-mdb-button-init
                data-mdb-ripple-init
                class="btn btn-dark btn-add-to-cart"
                (click)="
                  handleCartBtnClicked_v2(
                    product,
                    selectedSizeId,
                    selectedColorId
                  )
                "
              >
                Th√™m v√†o gi·ªè h√†ng
              </button>
              <button
                *ngIf="
                  !getVariationBySizeAndColor() ||
                  getVariationBySizeAndColor()?.quantity === 0
                "
                type="button"
                style="background-color: black"
                data-mdb-button-init
                data-mdb-ripple-init
                class="btn btn-dark ms-3 btn-add-buy-now"
                disabled
              >
                Mua ngay
              </button>
              <button
                *ngIf="
                  getVariationBySizeAndColor() &&
                  getVariationBySizeAndColor()?.quantity !== 0
                "
                type="button"
                style="background-color: black"
                data-mdb-button-init
                data-mdb-ripple-init
                class="btn btn-dark ms-3 btn-add-buy-now"
                (click)="
                  handleCartBtnClicked_v3(
                    product,
                    selectedSizeId,
                    selectedColorId
                  )
                "
              >
                Mua ngay
              </button>
            </div>

            <p>M√¥ t·∫£:</p>
            <p>{{ product?.productVariations?.[0]?.desc }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-5">
  <div class="container">
    <div class="row text-left p-2 pb-3">
      <h4>S·∫£n ph·∫©m li√™n quan</h4>
    </div>
    <div class="row">
      <app-related-products class="col-lg" />
    </div>
  </div>
</section>

<app-footer />
