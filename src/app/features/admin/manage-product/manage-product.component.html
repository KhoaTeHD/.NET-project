<div id="layoutSidenav_content">
  <main>
    <div class="container-fluid px-4">
      <h1 class="mt-4">Sản phẩm</h1>
      <div class="mb-3 d-flex flex-row-reverse">
        <button type="button" class="btn btn-dark" (click)="showDialogProduct('Add', {})">Thêm sản phẩm</button>
      </div>
      <div class="card mb-4">
        <p-toast></p-toast>
        <p-confirmDialog />
        <div class="card-body">
          <p-table #table [value]="products" dataKey="id" [tableStyle]="{ 'min-width': '50rem' }"
            class="table table-striped table-bordered">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 5rem;"></th>
                <th style="width: 10%;">Mã sản phẩm</th>
                <th style="width: 55%;">Tên sản phẩm</th>
                <th style="width: 15%;">Trạng thái</th>
                <th style="width: 15%;">Hành động</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product let-expanded="expanded">
              <tr>
                <td>
                  <p-button type="button" pRipple [pRowToggler]="product" [text]="true" [rounded]="true" [plain]="true"
                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
                </td>
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.status ? 'Hoạt động' : 'Ngừng bán' }}</td>
                <td>
                  <div class="flex align-items-center justify-content-center gap-2">
                    <button pButton pRipple type="button" icon="pi pi-plus" (click)="showDialogVariation('Add', { pro_Id: product.id})"
                      class="p-button-rounded p-button-text p-button-success">
                    </button>
                    <button pButton pRipple type="button" icon="pi pi-pencil" (click)="showDialogProduct('Edit', product)" class="p-button-rounded p-button-text">
                    </button>
                    <button pButton pRipple type="button" icon="pi pi-trash" (click)="deleteProduct(product)"
                      class="p-button-rounded p-button-text p-button-danger">
                    </button>
                  </div>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="rowexpansion" let-product>
              <td colspan="5">
                <div class="p-2">
                  <p-table [value]="product.productVariations">
                    <ng-template pTemplate="header">
                      <tr>
                        <th style="width: 10rem;">Mã biến thể</th>
                        <th style="width: 10rem;">Màu sắc</th>
                        <th style="width: 10rem;">Kích thước</th>
                        <th style="width: 10rem;">Giá</th>
                        <th style="width: 10rem;">Số lượng</th>
                        <th style="width: 10rem;">Giảm giá</th>
                        <th style="width: 10rem;">Trạng thái</th>
                        <th style="width: 10rem;">Hành động</th>
                      </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-variation>
                      <tr>
                        <td>{{ variation.id }}</td>
                        <td>{{ variation.color.name }}</td>
                        <td>{{ variation.size.name }}</td>
                        <td>{{ variation.price | currency: 'VND' }}</td>
                        <td>{{ variation.quantity }}</td>
                        <td>{{ variation.discount }}%</td>
                        <td>{{ variation.status ? 'Hoạt động' : 'Ngừng bán' }}</td>
                        <td>
                          <div class="flex align-items-center justify-content-center gap-2">
                            <button pButton pRipple type="button" icon="pi pi-pencil" (click)="showDialogVariation('Edit', variation)" class="p-button-rounded p-button-text">
                            </button>
                            <button pButton pRipple type="button" icon="pi pi-trash" (click)="deleteVariation(variation)"
                              class="p-button-rounded p-button-text p-button-danger">
                            </button>
                          </div>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </td>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </main>
  <app-admin-footer></app-admin-footer>
</div>

<p-dialog header="{{ dialogTitle }} sản phẩm" [modal]="true" [(visible)]="visibleDialogProduct" [style]="{ width: '30rem' }"
  styleClass="p-fluid">
  <div class="mb-4">
    <label for="id" class="form-label">Mã sản phẩm</label>
    <input type="text" class="form-control" [(ngModel)]="product.id" id="id" name="id" disabled>
  </div>
  <div class="mb-4">
    <label for="name" class="form-label">Tên sản phẩm</label>
    <input type="text" class="form-control" [(ngModel)]="product.name" id="name" placeholder="Nhập tên" name="name">
  </div>
  <div class="mb-4">
    <label class="form-check-label me-2" for="active">Trạng thái:</label>
    <input class="form-check-input" type="radio" name="active" id="visible" [(ngModel)]="product.status" [value]="true"> Hoạt động
    <input class="form-check-input ms-2" type="radio" name="active" id="disable" [(ngModel)]="product.status" [value]="false"> Ngừng bán
  </div>
  <div class="d-flex justify-content-end gap-2 mt-4">
    <p-button label="Hủy" severity="secondary" (onClick)="visibleDialogProduct = false" />
    <p-button label="Lưu" (onClick)="dialogTitle === 'Thêm' ? createNewProduct() : editProduct()" />
  </div>
</p-dialog>

<p-dialog header="{{ dialogTitle }} biến thể" [modal]="true" [(visible)]="visibleDialogVariation" [style]="{ width: '55rem' }"
  styleClass="p-fluid">
  <div id="variationsContainer">
    <div class="variation-item mb-3">
      <div class="row">
        <div class="col-md-6">
          <label for="col_Id" class="form-label">Màu sắc</label>
          <p-dropdown [(ngModel)]="variation.col_Id" [options]="colors" optionValue="id" optionLabel="name">
            <!-- <ng-template pTemplate="selectedItem">
              <div *ngIf="variation.col_Id">
                {{ variation.color?.name }}
              </div>
            </ng-template> -->
            <!-- <ng-template let-color pTemplate="item">
              {{ color.name }}
            </ng-template> -->
          </p-dropdown>
        </div>
        <div class="col-md-6">
          <label for="siz_Id" class="form-label">Kích thước</label>
          <p-dropdown [(ngModel)]="variation.siz_Id" [options]="sizes" optionValue="id" optionLabel="name">
            <!-- <ng-template pTemplate="selectedItem">
              <div *ngIf="variation.siz_Id">
                {{ variation.size?.name }}
              </div>
            </ng-template>
            <ng-template let-size pTemplate="item">
              {{ size.name }}
            </ng-template> -->
          </p-dropdown>
        </div>
        <div class="col-md-4 mt-3">
          <label for="price" class="form-label">Đơn giá</label>
          <!-- <input type="number" [(ngModel)]="variation.price" class="form-control" name="price" /> -->
          <p-inputNumber 
            inputId="price" 
            [(ngModel)]="variation.price"
            mode="currency" 
            currency="VND" 
            locale="vi-VN"  /> 
        </div>
        <div class="col-md-4 mt-3">
          <label for="quantity" class="form-label">Số lượng</label>
          <input type="number" [(ngModel)]="variation.quantity" class="form-control" name="quantity" />
        </div>
        <div class="col-md-4 mt-3">
          <label for="discount" class="form-label">Khuyến mãi</label>
          <input type="number" [(ngModel)]="variation.discount" class="form-control" name="discount" />
        </div>
        <div class="col-md-4 mt-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" [(ngModel)]="variation.status" name="status" />
            <label class="form-check-label" for="status">
              Hoạt động
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-end gap-2 mt-4">
    <p-button label="Hủy" severity="secondary" (onClick)="visibleDialogVariation = false" />
    <p-button label="Lưu" (onClick)="dialogTitle === 'Thêm' ? createNewVariation() : editVariation()" />
  </div>
</p-dialog>